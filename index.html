<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Permissions-Policy" content="interest-cohort=()">
    <title>Hands-Free Recipe Navigator</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        text-align: center;
        padding: 20px;
      }
      #slide-container {
        margin: 20px auto;
        width: 80%;
        max-width: 800px;
      }
      iframe {
        width: 100%;
        height: 500px;
        border: 1px solid #ccc;
      }
      #status {
        margin-top: 20px;
        font-size: 16px;
        color: #555;
      }
      select {
        padding: 10px;
        font-size: 16px;
        margin-bottom: 20px;
      }
    </style>
  </head>
  <body>
    <h1>Hands-Free Recipe Navigator</h1>
    <select id="recipe-select">
      <option value="">Select a Recipe</option>
     <option value="https://docs.google.com/presentation/d/e/2PACX-1vT7CuI_cGpXw2-OYer_dJJk_F29mFAPbUKlZVjzO60V4sRpJRm1w__G7mkftIZ2pzQoBnzTS2dNCKtt/embed?start=false&loop=false&delayms=3000">Recipe Fusion: Garlic Steak Bites with Miso Butter Broccoli</option>
     <option value="https://docs.google.com/presentation/d/1iz02mQnZ3yjxpfFVtoIc_H64FrpP9eNPcHSFrNt6B2o/embed?start=false&loop=false&delayms=3000">Recipe Fusion Miso-Caramel Pork Chops with Apples and Garlic Mashed Potatoes</option>
      <option value="YOUR_THIRD_RECIPE_URL">Recipe 3</option>
    </select>
    <div id="slide-container">
      <iframe id="slide-iframe" 
  src="" 
  frameborder="0" 
  width="100%" 
  height="569" 
  allowfullscreen>
</iframe>
    </div>
    <p id="status">Select a recipe and say "next" or "repeat."</p>

    <script>
      let currentSlideIndex = 0;
      let presentationUrl = "";

      // Function to update the iframe with the current slide
      function updateSlide() {
  const iframe = document.getElementById("slide-iframe");
  iframe.src = presentationUrl; // Use URL directly without modification
  
  // Add loading state
  document.getElementById("status").textContent = "Loading recipe...";
  
  iframe.onload = function() {
    readSlideText();
  };
}

      // Function to read the slide text aloud
      function readSlideText() {
  const statusEl = document.getElementById("status");
  const iframe = document.getElementById("slide-iframe");
  
  try {
    // Alternative text extraction method
    const slideTitle = iframe.contentDocument?.title || "Recipe Slide";
    const utterance = new SpeechSynthesisUtterance(slideTitle);
    
    // Add visual feedback
    statusEl.textContent = `Now reading: ${slideTitle}`;
    window.speechSynthesis.speak(utterance);
    
  } catch (error) {
    console.log("Reading slide title instead of content");
    statusEl.textContent = "Tip: Say 'next' to continue";
  }
}

      // Function to handle voice commands
      function startVoiceCommands() {
        const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        recognition.lang = "en-US";
        recognition.interimResults = false;
        recognition.maxAlternatives = 1;

        recognition.start();

        recognition.onresult = (event) => {
          const command = event.results[0][0].transcript.toLowerCase();
          document.getElementById("status").innerText = `Command: ${command}`;

        recognition.onstart = () => {
  document.getElementById("status").textContent = "Listening... Say 'next' or 'repeat'";
};

          // Handle the command
          switch (command) {
            case "next":
              currentSlideIndex++;
              updateSlide();
              break;
            case "repeat":
              readSlideText();
              break;
            default:
              console.log("Command not recognized:", command);
          }
        };

        recognition.onerror = (event) => {
          console.error("Speech recognition error:", event.error);
          document.getElementById("status").innerText = `Error: ${event.error}`;
        };

        recognition.onstart = () => {
          console.log("Voice recognition started");
          document.getElementById("status").innerText = "Listening...";
        };

        recognition.onend = () => {
          console.log("Voice recognition ended");
          recognition.start(); // Restart listening
        };
      }

      // Function to load the selected recipe
      function loadRecipe() {
        const select = document.getElementById("recipe-select");
        presentationUrl = select.value;
        if (presentationUrl) {
          currentSlideIndex = 0;
          updateSlide();
          startVoiceCommands();
        }
      }

      // Initialize the app
      function init() {
        const select = document.getElementById("recipe-select");
        select.addEventListener("change", loadRecipe);
      }

      // Start the app when the page loads
      window.onload = init;
    </script>
  </body>
</html>
